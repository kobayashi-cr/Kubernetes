# 第1章 イントロダクション

## 本書の目的とゴール

本書は「Dockerは少しは触ったことがあるが、Kubernetesは初めて」という方に向けて、Kubernetesの基礎から実践までをやさしく解説する入門書です。

### 本書で学べること

本書を読み終える頃には、以下のことができるようになります。

**1. Kubernetesの基本概念を理解する**  
まず、Kubernetesの基本概念を理解できるようになります。Pod、ReplicaSet、Deployment、Serviceの役割と関係性を学び、レストランの厨房に例えた直感的な理解を得ることができます。

**2. 学習環境を構築し、直感的に操作する**  
次に、実際にKubernetesクラスタを構築できるようになります。Docker Desktopとkindを使った学習環境の構築方法を学び、LENSというGUIツールを使った直感的な操作を体験できます。

**3. Webサービスをデプロイし、PCからアクセスする**  
さらに、WebサービスをKubernetes上で動かせるようになります。基本的なPodの起動から始まり、Deploymentによる管理、ConfigMapとSecretを使った設定管理、そしてServiceを使ってPC端末からアクセスできるようにするまで、一連の流れを実践できます。

**4. 自動スケーリング機能を体験する**  
また、スケーラブルなWebサービスを構築できるようになります。KNativeを使った自動スケーリング機能を学び、負荷に応じてPod数が自動で増減する仕組みを体験できます。

**5. 監視と運用の基礎を身につける**  
最後に、監視と運用の基礎を学ぶことができます。Grafanaを使ったKubernetesクラスタの監視方法を学び、リソース使用量やPodの状態を可視化する技術を身につけることができます。

### 本書の特徴

**1. レストランの比喩で分かりやすく**  
Kubernetesの複雑な概念を、レストランの厨房運営に例えて説明します。シェフ（コンテナ）、調理台（Pod）、ホールスタッフ（Service）など、身近な例で理解を深められます。

**2. GUIツールを活用した直感的な学習**  
コマンドラインだけでなく、LENSというGUIツールを積極的に使用。リソースの状態を視覚的に確認しながら学習を進められます。

**3. 実際に動かしながら学ぶ**  
理論だけでなく、実際にFastAPIを使ったWebアプリケーションをデプロイし、スケーリングや監視まで体験できます。

**4. 段階的な学習構成**  
基本概念から始まり、環境構築、実践、監視まで、無理なくステップアップできる構成になっています。

### 前提知識

本書では以下の知識があることを前提としています：

- **Dockerの基本操作**
  - `docker run`、`docker build`などの基本コマンド
  - Dockerfileの基本的な書き方
  - Dockerイメージの概念

- **Linuxの基本コマンド**
  - `ls`、`cd`、`cat`、`vi`などの基本的なファイル操作
  - プロセスの確認方法

- **Webアプリケーションの基本概念**
  - HTTPリクエスト・レスポンスの仕組み
  - ポート番号の概念

これらの知識が不足している場合でも、本書内で必要に応じて補足説明を加えていますので、安心して読み進めてください。

### 学習環境について

本書では、以下の環境で学習を進めます：

- **Docker Desktop** - Kubernetesクラスタを動かす基盤
- **kind** - 学習用のKubernetesクラスタ構築ツール
- **LENS** - KubernetesクラスタをGUIで操作するツール
- **kubectl** - Kubernetesのコマンドラインツール

これらのツールはすべて無料で利用でき、ローカル環境でKubernetesを体験できます。クラウド環境は不要です。

### 本書の構成

- **第1章** - Kubernetesの概要と本書の目的
- **第2章** - Kubernetesの基本概念（レストラン比喩による説明）
- **第3章** - 学習環境の構築（Docker Desktop、kind、LENS）
- **第4章** - 基本操作とWebサービス構築
- **第5章** - スケーラブルなWebサービスと監視
- **第6章** - さらなる学習に向けて

それでは、Kubernetesの世界へようこそ！一緒に学んでいきましょう。

## Kubernetesとは？

Kubernetesは、多数のコンテナを効率よく管理するための仕組み（オーケストレーションツール）です。

### コンテナとは？

まず、コンテナについて説明しましょう。

**コンテナ = アプリケーションを動かすための「箱」**

コンテナは、アプリケーションとその実行に必要な環境（OS、ライブラリ、設定ファイルなど）を一つにまとめた「箱」のようなものです。

#### コンテナの特徴

コンテナには以下のような特徴があります：

- **独立性** - 各コンテナは独立して動作し、他のコンテナに影響しない
- **可搬性** - どこでも同じ環境で動作する
- **専門性** - 一つのアプリケーションに特化している
（ここに3つの特徴を説明するイラストを入れる）

#### 従来のサーバー運用との違い

**従来の方法（物理サーバー）**  
従来の方法では、一つのサーバーに複数のアプリケーションをインストールしていました。
この方法では、アプリケーション同士が影響し合う可能性があり、サーバーが壊れるとすべてのアプリケーションが停止してしまうという問題がありました。

**コンテナを使った方法**  
コンテナを使った方法では、一つのサーバーに複数のコンテナを配置します。
各コンテナは独立しているため互いに影響せず、一つのコンテナが壊れても他のコンテナは正常に動作し続けます。
また、コンテナは必要に応じて簡単に増減が可能になっています。

つまり、コンテナは、アプリケーションを「どこでも動く、独立した単位」として扱えるようにする技術なのです。

### Kubernetesの役割

Kubernetesは以下のような重要な機能を自動で行ってくれます：

- **コンテナの自動復旧** - コンテナが停止したら自動で再起動
- **スケーリング** - 負荷に応じてコンテナ数を自動で増減
- **外部公開** - 外部からアクセスできるように自動で設定
- **分散配置** - 複数のサーバーにコンテナを効率的に配置
（ここに4つの特徴を説明するイラストを入れる）

つまり、大量のコンテナを「安全・効率的・止まらない」状態で運用するために欠かせない存在なのです。

### レストランの運営に例えて理解する

Kubernetesの役割を理解するために、レストランの運営に例えてみましょう。
Kubernetesとは、一言で言えば、レストランの総支配人のような存在なのです。

レストランで総支配人が果たす役割を考えてみてください：

- **シェフ（コンテナ）が倒れても、新しいシェフをすぐ補充して料理を継続できるようにする**
  - 一人のシェフが体調を崩しても、すぐに代わりのシェフを手配
  - お客さんは料理の提供が止まることなく、サービスを受け続けられる
  - これは、Webアプリケーションのコンテナが予期せず停止した場合に、Kubernetesが自動的に新しいコンテナを起動してサービスを継続させる仕組みに相当します

(ここにイラストを挿入)

- **調理台（Pod）の数を、お客さんの数に合わせて自動で増減できるようにする**
  - ランチタイムでお客さんが急増したら、調理台を増設
  - 夜の時間帯でお客さんが減ったら、調理台を減らしてコストを削減
  - これは、Webアプリケーションへのアクセス数が増えた場合に、Kubernetesが自動的にPod数を増やして負荷に対応し、アクセス数が減ったらPod数を減らしてリソースを効率化する仕組みに相当します

(ここにイラストを挿入)

- **厨房（Node）の空き状況を見ながら、どの調理台をどの厨房に置くかを判断する**
  - メイン厨房が混雑しているなら、サブ厨房に調理台を配置
  - 各厨房の負荷を均等に保ち、効率的に運営
  - これは、Kubernetesが各Worker Nodeのリソース使用状況を監視し、CPUやメモリの空きが多いNodeに新しいPodを配置して、クラスタ全体の負荷を均等に分散させる仕組みに相当します

(ここにイラストを挿入)

- **ホールスタッフ（Service）を通じて、お客さんが待たずに料理を受け取れるようにする**
  - お客さんは厨房の場所を覚える必要がない
  - ホールスタッフが注文した料理をお客さんに届ける
  - これは、ユーザーがWebアプリケーションにアクセスする際に、Podの場所を意識する必要がなく、Serviceが適切なPodにリクエストを転送し、複数のPod間で負荷分散を行う仕組みに相当します

(ここにイラストを挿入)

**総支配人がいなければレストランは混乱する**

もし総支配人がいなかったらどうなるでしょうか？

シェフが倒れても誰も気づかず料理が止まってしまい、お客さんが増えても調理台を増やせず待ち時間が長くなってしまいます。厨房の配置が非効率で無駄な動きが多くなり、お客さんは厨房を直接探さなければならず混乱してしまうでしょう。

(ここにイラストを挿入)

つまり、総支配人がいることで全体が調和し、効率よくお客さんに料理を提供できるようになります。

これがKubernetesの果たす役割です。Kubernetesは、コンテナという「シェフ」たちを効率的に管理し、サービスが止まらないように自動で調整してくれる「総支配人」なのです。

## Dockerとの違い

DockerとKubernetesは、どちらもコンテナ技術に関連していますが、それぞれ異なる役割を果たしています。この違いを理解することで、なぜKubernetesが必要なのかが分かります。

### Dockerの役割

Dockerは「コンテナを作って動かす」仕組みです。アプリケーションとその実行環境を一つのコンテナとしてパッケージ化し、どこでも同じように動作させることができます。

レストランの例でいうと、Dockerは「1人のシェフが1つの料理を作る」イメージです。シェフは自分の調理道具とレシピを持って、独立して料理を作ることができます。

### Dockerだけでは解決できない課題

しかし、1人のシェフに任せれば料理はできるものの、レストランとして運営するには以下のような課題が発生します：

**シェフが倒れたら誰が代わりを務めるのか？**
一人のシェフが体調を崩したり、休暇を取ったりした場合、料理が作れなくなってしまいます。Dockerでは、コンテナが停止した場合の自動復旧機能は提供されていません。

**お客さんが一気に増えたら、どうやってシェフを増やすのか？**
ランチタイムでお客さんが急増した場合、一人のシェフでは対応できません。Dockerでは、コンテナ数を手動で増やす必要があり、負荷に応じた自動スケーリングはできません。

**どの調理台で誰がどの料理を作るのかを誰が決めるのか？**
複数のシェフがいる場合、誰がどの料理を担当するか、どの調理台を使うかを管理する必要があります。Dockerでは、複数のコンテナを効率的に管理・調整する機能は限定的です。

**ホールスタッフがいないと、お客さんは厨房の場所を直接探さなければならない**
お客さんが直接厨房に行って料理を注文するのは非効率です。Dockerでは、複数のコンテナに適切にアクセスを振り分ける機能は標準では提供されていません。

### Kubernetesの役割

Kubernetesは「大量のコンテナを管理し、運用を自動化する」仕組みです。Dockerで作成したコンテナを、より効率的に運用するためのオーケストレーションツールです。

レストランの例でいうと、Kubernetesは「レストラン全体の運営を管理する総支配人」です。シェフ（コンテナ）の配置、調理台（Pod）の管理、ホールスタッフ（Service）の調整など、レストラン運営に必要なすべての要素を統合的に管理します。

### DockerとKubernetesの関係

DockerとKubernetesは対立する技術ではなく、相互に補完し合う関係にあります。

**Dockerが基盤**
Dockerは、コンテナを作成・実行するための基盤技術です。アプリケーションをコンテナ化し、どこでも同じように動作させることができます。

**Kubernetesがオーケストレーション**
Kubernetesは、Dockerで作成したコンテナを効率的に管理・運用するためのオーケストレーションツールです。複数のコンテナを協調させ、安定したサービスを提供します。

### まとめ

DockerとKubernetesは、どちらも重要ですが、役割が異なります。Dockerが「コンテナを作って動かす」基盤であり、Kubernetesが「その上のオーケストレーション」を担います。

レストランに例えると、Dockerは「一人前のシェフを作る技術」、Kubernetesは「レストラン全体を効率的に運営するシステム」という関係です。両者が組み合わさることで、安定したサービス提供が実現できるのです。

## 本書で構築する学習環境の全体像

本書では、実際にKubernetesクラスタを構築して、手を動かしながら学習を進めていきます。

### 学習環境の構成

**使用するツール**
- **Docker Desktop** - Kubernetesクラスタを動かす基盤
- **kind** - 学習用のKubernetesクラスタ構築ツール
- **LENS** - KubernetesクラスタをGUIで操作するツール
- **kubectl** - Kubernetesのコマンドラインツール

**クラスタ構成**
- **controller** - Kubernetesクラスタの管理用ノード（1台）
- **worker** - アプリケーションを実行するノード（2台）

### なぜこの構成なのか？

**小規模でも実践的**  
本番環境と同じ仕組みを体験できる構成になっています。ローカル環境で完結するためコストがかからず、短時間でクラスタを構築・破棄できるため、気軽に実験できます。

**段階的な学習**  
基本操作から始まり、徐々に高度な機能を体験できる構成です。Pod、Service、Deploymentの基本概念を実践で理解し、最終的にはKNativeによる自動スケーリングまで体験することができます。

### 学習の流れ

1. **環境構築** - Docker Desktop、kind、LENSの導入
2. **基本操作** - Pod、ReplicaSet、Deploymentの作成と管理
3. **設定管理** - ConfigMap、Secretを使った設定の外部化
4. **外部公開** - Serviceを使ったWebサービスの公開
5. **データ永続化** - Volume、PersistentVolumeを使ったデータ管理
6. **自動スケーリング** - KNativeによる負荷対応
7. **監視** - Grafanaを使ったクラスタの可視化

### 体験できること

本書を読み終える頃には、以下のような実践的なスキルが身につきます：

- **Kubernetesクラスタの構築と運用**
- **Webアプリケーションのデプロイと管理**
- **設定や機密情報の安全な管理**
- **負荷に応じた自動スケーリング**
- **クラスタの状態監視とダッシュボード作成**

小規模ながら、実際のクラウド環境と同じ仕組みを学べる構成になっています。それでは、一緒にKubernetesの世界を体験していきましょう！
