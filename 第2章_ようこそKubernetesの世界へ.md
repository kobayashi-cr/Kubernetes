# 第2章 ようこそKubernetesの世界へ

## Kubernetesの基本概念

Kubernetesを理解するには、まず「Pod・ReplicaSet・Deployment・Service」の4つの基本概念を押さえることが重要です。これらの概念は相互に関連しており、一つ一つを理解することで、Kubernetesの全体像が見えてきます。

本書では、これらの概念をレストランの比喩を用いて直感的に理解できるように解説します。抽象的な技術用語を身近な例に置き換えることで、複雑な概念も分かりやすく学べるようになります。

概念を学んだ後は、実際にハンズオンで動かして体験することで、理論と実践の両面から理解を深めていきましょう。

### なぜこの4つの概念が重要なのか

Kubernetesには数多くの概念がありますが、この4つは特に重要です。なぜなら、これらが組み合わさることで、Kubernetesの基本的な機能が実現されるからです。

**Pod**は、アプリケーションを動かす最小単位です。コンテナを包む「箱」のような存在で、実際の処理を行う場所です。  
**ReplicaSet**は、Podの数を自動で調整する仕組みです。指定した数のPodが常に動いているように管理します。  
**Deployment**は、ReplicaSetを管理しながら、アプリケーションの更新やスケーリングを行います。スケーリングとは、負荷に応じてアプリケーションの数を自動で増減させることです。実運用では欠かせない存在です。  
**Service**は、Podに安定したアクセス経路を提供します。外部からアプリケーションにアクセスするための入り口となります。  
(ここにイラストを入れる)


これらの概念を理解することで、Kubernetesがどのようにアプリケーションを管理しているのかが分かるようになります。次のセクションでは、それぞれの概念を詳しく見ていきましょう。

## Pod, ReplicaSet, Deployment, Service の役割

Kubernetesの4つの基本概念について、それぞれの役割を詳しく見ていきましょう。レストランの厨房運営に例えることで、抽象的な概念を具体的にイメージできるようになります。

### Pod - 調理台

**Pod**は、Kubernetesの最小実行単位で、1つ以上のコンテナをまとめる箱のような存在です。レストランでいう「調理台」にあたり、シェフ（コンテナ）がそこで働きます。

調理台には1人のシェフ（コンテナ）が立って料理を作ります。ときには補助のシェフ（別のコンテナ）が隣で手伝うこともあります。調理台ごとに独立していて、壊れたら交換が必要です。

(ここにイラストを入れる)

Podは短命で入れ替わるため、上位の仕組みと組み合わせて使うのが前提となります。単体では不安定な存在ですが、適切に管理することで安定したサービスを提供できます。

### ReplicaSet - 調理台の数管理

**ReplicaSet**は、Podの数を常に一定に保つ仕組みです。調理台の数を管理し、壊れたら自動で補充するイメージです。

例えば、3つの調理台が必要な場合、ReplicaSetは常に3つのPodが動いているように管理します。1つのPodが壊れても、すぐに新しいPodを作成して、常に3つのPodが動いている状態を維持します。

(ここにイラストを入れる)

サービスの可用性を高める重要な仕組みですが、更新は不得意なので、通常はDeploymentと組み合わせて使います。

### Deployment - 厨房のマネージャー

**Deployment**は、ReplicaSetを管理しながら更新・ロールバック・スケーリングを実現する仕組みです。スケーリングとは、負荷に応じてアプリケーションの数を自動で増減させることです。レストランでいう「厨房のマネージャー」で、レシピ変更や調理台の増減を指示します。

新しいレシピ（アプリケーション）を導入する際、Deploymentは段階的に更新を行います。まず新しいレシピで調理台を準備し、問題がなければ古い調理台を撤去します。問題があれば、すぐに元のレシピに戻すこともできます。

(ここにイラストを入れる)

サービスを止めずにアプリを更新できるため、実運用では必須の存在です。

### Service - ホールスタッフ

**Service**は、Podに安定したアクセス経路を提供し、負荷分散も行う仕組みです。レストランでいう「ホールスタッフ」で、お客さんを正しい調理台に案内します。

お客さん（ユーザー）は、調理台（Pod）の場所を覚える必要がありません。ホールスタッフ（Service）が適切に注文した料理を運んでくれるからです。調理台が入れ替わっても、お客さんは気にせず注文した料理を料理を受け取ることができます。

(ここにイラストを入れる)

ClusterIP、NodePort、LoadBalancerなどの種類があり、用途によって使い分けます。
これらの違いについては、後で詳しく説明していきます。

### 4つの概念の関係性

これらの4つの概念が組み合わさることで、レストラン（Kubernetesクラスタ）は効率よく安定して運営できます。

- **Pod**は調理台（実際に作業する場所）
- **ReplicaSet**は調理台の数を管理（必要な数を維持）
- **Deployment**はマネージャー（更新やスケーリングを指示）
- **Service**はホールスタッフ（お客さんを適切な場所に案内）

Kubernetesは「レストラン運営の自動化システム」として理解すると分かりやすいでしょう。次のセクションでは、これらの概念をより詳しく見ていきます。

## Master NodeとWorker Node の関係

Kubernetesクラスタは、**Master Node**と**Worker Node**という2種類のノードで構成されています。これらの関係を理解することで、Kubernetesがどのように動作しているのかが分かります。

### 基本的な役割分担

Master Nodeは「頭脳」、Worker Nodeは「手足」という関係です。Masterが管理・判断を行い、Workerが実際にアプリケーションを実行します。

レストラン比喩では「本部の経営陣」と「各店舗の厨房」の関係に例えることができます。

### Master Node - 本部の経営陣

Master Nodeは、Kubernetesクラスタ全体を管理・制御する役割を担います。レストランでいう「本部の経営陣」に相当します。

本部の経営陣は以下のような重要な判断を行います：

- **調理台の配置決定** - どの店舗に調理台を配置するかを決める（どのWorker NodeにPodを配置するかを決定）
- **メニュー導入の方針** - 新しいメニューを導入するときの方針を出す（新しいアプリケーションのデプロイ戦略を決定）
- **店舗の稼働状況把握** - 各店舗の稼働状況を常に把握している（各Worker Nodeのリソース使用状況を監視）

(ここにイラストを入れる)

Master Nodeは、クラスタ全体の状態を監視し、必要な調整を行います。例えば、新しいPodの作成指示、既存Podの削除、Serviceの設定変更、ConfigMapやSecretの更新などの指示をWorker Nodeに送ります。また、クラスタ全体のリソース使用状況を把握し、負荷分散やスケーリングの判断を行い、理想的な状態を維持します。

### Worker Node - 各店舗の厨房

Worker Nodeは、実際にアプリケーションを実行する場所です。レストランでいう「各店舗の厨房」に相当します。

各店舗の厨房では以下のような作業が行われます：

- **実際の料理制作** - 実際にシェフ（コンテナ）が料理を作る場所（Webアプリケーションやデータベースなどのコンテナが実際に動作する）
- **調理台の配置** - 本部の指示に従って、調理台（Pod）を配置する（Master Nodeから指示されたPodを適切に起動・配置する）
- **作業の実行** - 本部からの指示を受けて、具体的な作業を実行する（Podの起動・停止、コンテナの実行、リソースの管理などの具体的な作業を実行する）

(ここにイラストを入れる)

Worker Nodeは、Master Nodeからの指示に従って、Podを起動・停止し、アプリケーションを実行します。例えば、Webアプリケーションのコンテナを動かしたり、データベースのコンテナを管理したり、バッチ処理を実行したりします。また、リソースの使用状況（CPUやメモリの使用量）をMaster Nodeに報告し、必要に応じて負荷分散の調整も行います。

### kube-apiserver, controller-manager, scheduler, etcdについて

Master Nodeは、複数のコンポーネントで構成されています。それぞれの役割をレストラン比喩で説明しましょう。

**kube-apiserver - 本部の受付窓口**  
本部の受付窓口として、外部からの指示を受け付けます。この「外部からの指示」とは、Kubernetesを運用管理するエンジニアからの指示のことです。例えば、新しいアプリケーションのデプロイ、Pod数の変更、設定の更新などの操作が含まれます。すべての操作はこの受付窓口を通じて行われます。

**controller-manager - 調整係**  
クラスタ全体の状態を監視し、理想的な状態を維持するための調整を行います。例えば、Podが予期せず停止した場合に自動で再起動したり、指定した数のPodが常に動いているように調整したりします。人事部門のような役割で、クラスタ内のリソースの健康状態を常に管理しています。

**scheduler - 配属マネージャー**  
新しく作成されたPodを、どのWorker Nodeに配置するかを決定します。シェフの配属を決めるマネージャーのような存在です。

**etcd - 総務台帳**
クラスタの現在の状態や設定情報を記録・管理します。例えば、どのPodがどのWorker Nodeで動いているか、Serviceの設定内容、ConfigMapの値、Secretの情報などを永続的に保存しています。組織図や店舗情報を記録しておく総務台帳のような役割です。

(ここにイラストを入れる)

これらのコンポーネントが連携することで、クラスタは常に理想の状態を保つことができます。レストラン本部の各部門が連携して、効率的な運営を実現しているのと同じです。

## Namespace, ConfigMap, Secret の概要

Kubernetesの基本操作に加えて、運用で必ず役立つ補助的な仕組みがあります。これらの概念は、Pod、ReplicaSet、Deployment、Serviceの4つの基本概念と組み合わせて使用することで、より実用的なシステムを構築できます。

### Namespace - フロア分け

**Namespace**は、クラスタ内のリソースをグループごとに整理する仕組みです。レストランでいう「フロア分け」で、同じ名前でも混乱しないように管理できます。

例えば、レストランの1階が「和食フロア」、2階が「洋食フロア」、3階が「中華フロア」のように分かれているとします。各フロアには同じ名前の料理（例：「ラーメン」）があっても、フロアが違えば混同することはありません。

(ここにイラストを記載)

Kubernetesでも同様に、開発環境用のNamespace、本番環境用のNamespace、テスト環境用のNamespaceなどに分けることで、同じ名前のリソースでも環境ごとに管理できます。チームや用途ごとに区切れるため、複数の開発者が同じクラスタを使用する場合に必須の機能です。

### ConfigMap - レシピ帳

**ConfigMap**は、アプリの設定値を外部化して管理する仕組みです。レストランでいう「レシピ帳」で、シェフ（コンテナ）はそれを参照して調理します。

レストランの厨房には、各料理のレシピが書かれたレシピ帳が置かれています。シェフはこのレシピ帳を見ながら、同じ味の料理を作ることができます。レシピを変更したい場合は、レシピ帳を更新するだけで、すべてのシェフが新しいレシピを参照できます。

(ここにイラストを記載)

Kubernetesでも同様に、データベースの接続先URL、APIエンドポイントのアドレス、アプリケーションの設定値などをConfigMapに保存し、複数のPodから参照できます。アプリケーションのコードを変更せずに、環境ごとに設定を切り替えることができるため、開発・テスト・本番環境での設定管理が簡単になります。

### Secret - 金庫の秘伝レシピ

**Secret**はパスワードやAPIキーなどの機密情報を安全に管理する仕組みです。レストランでいう「金庫に入った秘伝のソースレシピ」のような存在です。

レストランの厨房には、一般のレシピ帳とは別に、金庫に保管された秘伝のソースレシピがあります。このレシピは限られたシェフだけが知ることができ、外部に漏れることがないよう厳重に管理されています。

(ここにイラストを記載)

Kubernetesでも同様に、データベースのパスワード、APIキー、SSL証明書などの機密情報をSecretに保存し、暗号化して管理します。ConfigMapでは扱えない大事な情報を安全に扱えるため、本番環境での運用には欠かせない機能です。

### 3つの概念の使い分け

これらの概念は、用途に応じて使い分けます：

- **Namespace** - リソースのグループ分け（環境やチームごとの分離）
- **ConfigMap** - 一般の設定値（URL、設定パラメータなど）
- **Secret** - 機密情報（パスワード、APIキーなど）

これらの仕組みを理解することで、Kubernetesを使った実用的なシステム構築が可能になります。次の章では、実際にこれらの概念を使ってWebサービスを構築していきましょう。
